

\subsubsection{Overview}
The Instruction Planner is placed at the top layer of the whole SmartSoft architecture,
therefore it is meant to be the "Swarm Manager" of all robots that work on a common task. \\
This approach is split up into two different aspects, one part of the Instruction Planner has to
observe all robots and the states they are currently in, as well as the actual task that they are working on.

\subsubsection{Idea}

The following picture \ref{fig:instr_overview} shows the internal structure of the
Instruction Planner.
As seen in the figure the Instruction Planner will do multiple things: \newpage
In Blue:\\
\begin{itemize}
    \item \textbf{Game Management:}  organization of next steps
    \begin{itemize}
        \item Exploration Management
            \begin{itemize}
                \item keeps log of found machines
                \item estimates explorable positions
                \item suggests next orders to reach the objective
            \end{itemize}
        \item Production Management
        \begin{itemize}
            \item coming up
        \end{itemize}
    \end{itemize}
    \item \textbf{Fleet Management:} organization of robots and their progress
    \begin{itemize}
        \item which state they are in (e.g disqualified / maintenance / active)
        \item what they are working on
        \item error handling
    \end{itemize}
\end{itemize}

\begin{figure}[h]
\centering
\includegraphics[scale=0.23]{pic/Instructionplanner2018.png}
\caption{Management of Robot Swarm and the Objective}
\label{fig:instr_overview}
\end{figure}
\newpage

Since the blue-part of figure \ref{fig:instr_overview} handles the internal management, it can be treated as an agent that provides the next orders for the robots, based on their actual situation.\\
This situation is brought into the Instruction Planner via the Sequencers of each
robot.\\
In Green: \\
\begin{itemize}
    \item \textbf{Sequencers}
    \begin{itemize}
        \item handle all events on robot
        \item local management of robot
    \end{itemize}
    \item \textbf{Components}
    \begin{itemize}
        \item actual hardware
        \item creates events
    \end{itemize}
\end{itemize}


\paragraph{Objective Management}
The objective management consists of multiple \textit{state machines}, that are in
a hierarchical order.
All state machines listen to the events that are received via the \textit{Sequencers}, or
the \textit{Refbox}.
The thought behind this architecture is an intelligent agent that can be "asked" for the next
best step to take.\\

\begin{itemize}
    \item \textbf{Game State Machine}
    \begin{itemize}
        \item first level state machine
        \item takes care of the game phases (e.g. Setup Phase, Exploration Phase, Production Phase)
         \item depending on the game state, events are forwarded to the next level state machine (e.g. Exploration State Machine)
    \end{itemize}
    \item \textbf{Exploration State Machine}
    \begin{itemize}
        \item takes care of all objectives that have to be fulfilled in the phase
        \item tells Sequencer, which position should be explored next
    \end{itemize}
\end{itemize}
\newpage

\subsubsection{Changes}
The previous implementation of the instruction planner as been changed completely to enhance the modularity.
The now given Skeleton is designed to be easily extended in various ways, e.g. for the use of multiple Robots
or the exchange of tactics using different implementation of agents. \\

\begin{figure}[h]
\centering
\includegraphics[scale=0.4]{pic/oldUse_Instructionplanner.png}
\caption{design related changes in Instruction Planner and Sequencer}
\label{fig:changes_instruction}
\end{figure}

The new version of the Instruction Planner does no longer work against the Smartsoft architecture\ref{fig:changes_instruction}.
By changing the architecture as seen in the figure the complexity of the Instruction planner is reduced and the task distribution improved.\\

The implementation now differs a lot from the old of 2017. Only view lines of code could be recycled and used again.
A completely new system has been introduced: the \textit{hierarchical state machines}. The implementation of
this system now is more modular, parts (e.g. the state machines for the phases) can easily be exchanged and
replaced with other approaches or implementations. \\
Overall the instruction planner has been completely redesigned and is still under construction.
\newpage

\subsubsection{Conclusion}
With the new architecture of the Instruction Planner multiple new features can be implemented.
\begin{itemize}
    \item \textbf{Multiple Robots} The new implementation would allow the use of multiple robots on the field, since
    the new architecture considers the use of multiple Sequencers.
    \item \textbf{Intelligent Agents} The \textit{Objective Management} is designed to work with agents that can be asked
    for the next steps, in the actual case the implementation works with state machines. Other implementations of Agents can
    also be fit into the interface.
    \item \textbf{divide et impera} Separating the robot management form the objective management separates two problems
    that can be handled individually: \textit{Objective Manager} creates the next task and the \textit{Fleet Manager} takes care
    of all robots and assigns this task to the best candidate. For the Fleet Manager a complete concept is needed, which is not part of this report.
\end{itemize}

The actual level of production does not contain a fully functional Instruction Planner.
The current state consists of the skeleton of the parts, the implementation of the
actual agent is missing as well as the logic to distribute the tasks to multiple robots.
Probably the first implementations of the \textit{Objective Manager} might be a
simple static implementation of a point pattern to follow, as well as a simple \textit{Fleet Manager} that
assigns just one order at a time to only one robot.

\newpage
